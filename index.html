<!DOCTYPE html>
<html>
<head>
    <title>Nexus Dynastie : Ultra Texture</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
        #login-screen { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: radial-gradient(circle, #111, #000); color: white; }
        input { padding: 12px; margin: 5px; border-radius: 8px; border: 1px solid #00f2ff; background: #111; color: white; width: 260px; }
        .btn { padding: 10px 25px; background: #00f2ff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #nav { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 15px; }
        .zone-btn { width: 60px; height: 60px; border-radius: 12px; border: 2px solid #00f2ff; background: rgba(0,0,0,0.6); color: white; font-size: 24px; cursor: pointer; transition: 0.3s; }
        .zone-btn:hover { box-shadow: 0 0 15px #00f2ff; transform: scale(1.1); }
        #stats { position: absolute; top: 20px; left: 20px; color: #00f2ff; font-size: 20px; font-weight: bold; text-shadow: 0 0 5px #000; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1 style="color:#00f2ff; text-shadow: 0 0 10px #00f2ff;">NEXUS DYNASTIE</h1>
        <input type="text" id="pseudo" placeholder="Pseudo">
        <input type="password" id="mdp" placeholder="Mot de passe">
        <button class="btn" onclick="connect()">SE CONNECTER</button>
    </div>

    <div id="stats">üí∞ <span id="gold">1000</span></div>

    <div id="nav">
        <button class="zone-btn" onclick="go('farm')">üå≥</button>
        <button class="zone-btn" onclick="go('adventure')">‚õèÔ∏è</button>
        <button class="zone-btn" onclick="go('pvp')">‚öîÔ∏è</button>
    </div>

<script src="/socket.io/socket.io.js"></script>
<script type="importmap">{"imports":{"three":"https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.module.js"}}</script>

<script type="module">
import * as THREE from 'three';

const socket = io();
let scene, camera, renderer, player, ground;
const textures = {};

// --- G√âN√âRATEUR DE TEXTURES (SANS IMAGES EXTERNES) ---
function generateTextures() {
    const canvas = document.createElement('canvas');
    canvas.width = 256; canvas.height = 256;
    const ctx = canvas.getContext('2d');

    // Texture Brique (pour aventure/pvp)
    ctx.fillStyle = '#444'; ctx.fillRect(0,0,256,256);
    ctx.strokeStyle = '#222'; ctx.lineWidth = 4;
    for(let i=0; i<8; i++) {
        for(let j=0; j<8; j++) {
            ctx.strokeRect(i*32 + (j%2*16), j*32, 32, 32);
        }
    }
    textures.brick = new THREE.CanvasTexture(canvas.cloneNode(true));
    textures.brick.wrapS = textures.brick.wrapT = THREE.RepeatWrapping;
    textures.brick.repeat.set(1, 1);

    // Texture Herbe (pour farm)
    ctx.fillStyle = '#1a3c1a'; ctx.fillRect(0,0,256,256);
    for(let i=0; i<500; i++) {
        ctx.fillStyle = `rgb(0, ${Math.random()*100 + 50}, 0)`;
        ctx.fillRect(Math.random()*256, Math.random()*256, 2, 2);
    }
    textures.grass = new THREE.CanvasTexture(canvas);
    textures.grass.wrapS = textures.grass.wrapT = THREE.RepeatWrapping;
}

window.connect = () => {
    const pseudo = document.getElementById('pseudo').value;
    const mdp = document.getElementById('mdp').value;
    if(pseudo && mdp) socket.emit('login', { pseudo, mdp });
};

socket.on('authSuccess', (data) => {
    document.getElementById('login-screen').style.display = 'none';
    generateTextures();
    init();
});

function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Lumi√®res
    const amb = new THREE.AmbientLight(0xffffff, 0.4);
    const sun = new THREE.DirectionalLight(0xffffff, 1);
    sun.position.set(10, 20, 10);
    sun.castShadow = true;
    scene.add(amb, sun);

    // Sol avec texture
    const groundGeo = new THREE.PlaneGeometry(1000, 1000);
    const groundMat = new THREE.MeshStandardMaterial({ map: textures.grass });
    ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI/2;
    ground.receiveShadow = true;
    scene.add(ground);

    // Joueur styl√©
    player = new THREE.Group();
    const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 0.8), new THREE.MeshStandardMaterial({ color: 0x00f2ff, emissive: 0x00f2ff, emissiveIntensity: 0.2 }));
    body.position.y = 0.8;
    body.castShadow = true;
    player.add(body);
    scene.add(player);

    const keys = {};
    window.onkeydown = e => keys[e.code] = true;
    window.onkeyup = e => keys[e.code] = false;

    window.go = (zone) => {
        if(zone === 'adventure') {
            ground.material.map = textures.brick;
            ground.material.color.set(0x555555);
            // Rajouter des murs
            for(let i=0; i<10; i++) {
                const wall = new THREE.Mesh(new THREE.BoxGeometry(2,4,2), new THREE.MeshStandardMaterial({map: textures.brick}));
                wall.position.set(Math.random()*40-20, 2, Math.random()*40-20);
                scene.add(wall);
            }
        } else {
            ground.material.map = textures.grass;
            ground.material.color.set(0xffffff);
        }
    };

    function animate() {
        requestAnimationFrame(animate);
        const speed = 0.15;
        if(keys['KeyW']) player.position.z -= speed;
        if(keys['KeyS']) player.position.z += speed;
        if(keys['KeyA']) player.position.x -= speed;
        if(keys['KeyD']) player.position.x += speed;

        camera.position.lerp(new THREE.Vector3(player.position.x, 8, player.position.z + 12), 0.1);
        camera.lookAt(player.position);
        renderer.render(scene, camera);
    }
    animate();
}
</script>
</body>
</html>
